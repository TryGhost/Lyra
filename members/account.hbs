{{!< ../default}}

<header class="site-header">
    {{> site-header}}
</header>
<main id="site-main" class="site-main site-account outer">
    <div class="inner">

    {{#if @member.paid}}

        {{!-- Logged in, paying member: Show account info --}}
        <div class="subscriber-box">
            <h1 class="subscriber-box-title">Your account</h1>

            {{#if cancel_at_period_end}}
                <p>
                    Hey <strong>{{@member.email}}</strong>! Your subscription will end on {{date current_period_end format="DD MMM YYYY"}}. If you change your mind in the meantime you can turn on renew and continue having access to all the content on {{@site.title}}.
                </p>
                {{cancel_link continueLabel="Turn on auto-renew"}}
            {{else}}
                <p>Hey! You have an active {{@site.title}} account with access to all areas. Get in touch if have any problems or need some help getting things updated, and thanks for subscribing.</p>
                <div class="subscriber-details">
                    {{#foreach @member.subscriptions}}
                
                        <div class="subscriber-detail">
                            <label class="subscriber-detail-label">Email address</label>
                            <span class="subscriber-detail-content">{{@member.email}}</span>
                        </div>
                    
                        <div class="subscriber-detail">
                            <label class="subscriber-detail-label">Your plan</label>
                            <span class="subscriber-detail-content">$<span class="plan-price">0</span>/{{plan.interval}}</span>
                        </div>
                    
                        <div class="subscriber-detail">
                            <label class="subscriber-detail-label">Card</label>
                            <span class="subscriber-detail-content">**** **** **** {{default_payment_card_last4}}</span>
                        </div>
                    
                        <div class="subscriber-detail">
                            <label class="subscriber-detail-label">Next bill date</label>
                            <span class="subscriber-detail-content">{{date current_period_end format="DD MMM YYYY"}}</span>
                        </div>
                    
                        <div class="ubsubscribe-button-container">
                            {{cancel_link cancelLabel="Cancel subscription"}}
                        </div>
                    
                        {{#contentFor "scripts"}}
                        <script>
                            $(document).ready(function () {
                                var planAmount = {{ plan.amount }} / 100;
                                $(".plan-price").html(planAmount);
                            });
                        </script>
                        {{/contentFor}}
                
                    {{/foreach}}
                </div>
            {{/if}}
        </div>

    {{else if @member}}

        {{!-- Logged in, not paying: Link to checkout --}}
        <div class="account-box">
            <h1 class="account-box-title">Currently, you're not a subscriber</h1>
            <p>Hey there! <strong>{{@member.email}}</strong> is subscribed to free updates from {{@site.title}}, but doesn't have a paid subscription to unlock full access.</p>
            <div class="authbox-signup">
                <a class="button primary" href="/signup/">
                    <span class="button-content">Subscribe now</span>
                </a>
            </div>
        </div>

    {{else}}

        {{!-- Not logged in: Redirect to signin --}}
        <script>window.location = '{{@site.url}}/signin/';</script>

    {{/if}}

    </div>
</main>